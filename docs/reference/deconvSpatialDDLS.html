<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Deconvolute spatial transcriptomics data using the trained model in
the SpatialDDLS object. The trained model is used
to predict cell proportions of two mirrored transcriptional profiles:
'Intrinsic' profiles: transcriptional profiles of each spot
in the ST dataset.
'Extrinsic' profiles: profiles simulated from the
surrounding spots of each spot.
After prediction, cell proportions
from the intrinsic profiles (intrinsic cell proportions) are regularized
based on the similarity between intrinsic and extrinsic profiles in order
to maintain spatial consistency. This approach leverages both transcriptional
and spatial information. For more details, see Mañanes et al., 2023 and the
Details section."><title>Deconvolute spatial transcriptomics data using trained model — deconvSpatialDDLS • SpatialDDLS</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Deconvolute spatial transcriptomics data using trained model — deconvSpatialDDLS"><meta property="og:description" content="Deconvolute spatial transcriptomics data using the trained model in
the SpatialDDLS object. The trained model is used
to predict cell proportions of two mirrored transcriptional profiles:
'Intrinsic' profiles: transcriptional profiles of each spot
in the ST dataset.
'Extrinsic' profiles: profiles simulated from the
surrounding spots of each spot.
After prediction, cell proportions
from the intrinsic profiles (intrinsic cell proportions) are regularized
based on the similarity between intrinsic and extrinsic profiles in order
to maintain spatial consistency. This approach leverages both transcriptional
and spatial information. For more details, see Mañanes et al., 2023 and the
Details section."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SpatialDDLS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href=".././articles/realModelExample-hq.html">Get started! Deconvolution of mouse lymph node samples</a>
    <a class="dropdown-item" href=".././articles/hdf5Backend.html">HDF5 files</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/diegommcc/SpatialDDLS">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Deconvolute spatial transcriptomics data using trained model</h1>
      <small class="dont-index">Source: <a href="https://github.com/diegommcc/SpatialDDLS/R/dnnModel.R" class="external-link"><code>R/dnnModel.R</code></a></small>
      <div class="d-none name"><code>deconvSpatialDDLS.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Deconvolute spatial transcriptomics data using the trained model in
the <code><a href="SpatialDDLS-class.html">SpatialDDLS</a></code> object. The trained model is used
to predict cell proportions of two mirrored transcriptional profiles:</p><ul><li><p>'Intrinsic' profiles: transcriptional profiles of each spot
in the ST dataset.</p></li>
<li><p>'Extrinsic' profiles: profiles simulated from the
surrounding spots of each spot.</p></li>
</ul><p>After prediction, cell proportions
from the intrinsic profiles (intrinsic cell proportions) are regularized
based on the similarity between intrinsic and extrinsic profiles in order
to maintain spatial consistency. This approach leverages both transcriptional
and spatial information. For more details, see Mañanes et al., 2023 and the
Details section.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">deconvSpatialDDLS</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">index.st</span>,</span>
<span>  normalize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scaling <span class="op">=</span> <span class="st">"standardize"</span>,</span>
<span>  k.spots <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  pca.space <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  fast.pca <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pcs.num <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  pca.var <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"euclidean"</span>,</span>
<span>  alpha.cutoff <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  alpha.quantile <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  simplify.set <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  simplify.majority <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use.generator <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  batch.size <span class="op">=</span> <span class="fl">64</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p><code><a href="SpatialDDLS-class.html">SpatialDDLS</a></code> object with
<code>trained.model</code> and <code>spatial.experiments</code> slots.</p></dd>


<dt>index.st</dt>
<dd><p>Name or index of the dataset/slide stored in the
<code>SpatialDDLS</code> object (<code>spatial.experiments</code> slot) to be
deconvolute. If missing, all datasets will be deconvoluted.</p></dd>


<dt>normalize</dt>
<dd><p>Normalize data (logCPM) before deconvolution (<code>TRUE</code> by
default).</p></dd>


<dt>scaling</dt>
<dd><p>How to scale data before training. Options include
<code>"standardize"</code> (values are centered around the mean with a unit
standard deviation) or <code>"rescale"</code> (values are shifted and rescaled so
that they end up ranging between 0 and 1). If <code>normalize = FALSE</code>,
data are not scaled.</p></dd>


<dt>k.spots</dt>
<dd><p>Number of nearest spots considered for each spot during
regularization and simulation of extrinsic transcriptional profiles. The
greater, the smoother the regularization will be (4 by default).</p></dd>


<dt>pca.space</dt>
<dd><p>Whether to use PCA space to calculate distances between
intrinsic and extrinsic transcriptional profiles (<code>TRUE</code> by default).</p></dd>


<dt>fast.pca</dt>
<dd><p>Whether using the <span class="pkg">irlba</span> implementation. If <code>TRUE</code>,
the number of PCs used is defined by the <code></code> parameter. If
<code>FALSE</code>, the PCA implementation from the <span class="pkg">stats</span> R package is
used instead (<code>TRUE</code> by default).</p></dd>


<dt>pcs.num</dt>
<dd><p>Number of PCs used to calculate distances if
<code>fast.pca == TRUE</code> (50 by default).</p></dd>


<dt>pca.var</dt>
<dd><p>Threshold of explained
variance (between 0.2 and 1) used to choose the number of PCs used if
<code>pca.space == TRUE</code> and <code>fast.pca == FALSE</code> (0.8 by default).</p></dd>


<dt>metric</dt>
<dd><p>Metric used to measure distance/similarity between intrinsic
and extrinsic transcriptional profiles. It may be <code>'euclidean'</code>,
<code>'cosine'</code> or <code>'pearson'</code> (<code>'euclidean'</code> by default).</p></dd>


<dt>alpha.cutoff</dt>
<dd><p>Minimum distance for regularization.
It may be <code>'mean'</code> (spots with transcriptional distances shorter than
the mean distance of the dataset will be modified) or <code>'quantile'</code>
(spots with transcriptional distances shorter than the
<code>alpha.quantile</code> quantile are used). <code>'mean'</code> by default.</p></dd>


<dt>alpha.quantile</dt>
<dd><p>Quantile used if <code>alpha.cutoff == 'quantile'</code>.
0.5 by default.</p></dd>


<dt>simplify.set</dt>
<dd><p>List specifying which cell types should be compressed
into a new label with the name of the list item. See examples for details.
If provided, results are stored in a list with <code>'raw'</code> and
<code>'simpli.set'</code> elements.</p></dd>


<dt>simplify.majority</dt>
<dd><p>List specifying which cell types should be
compressed into the cell type with the highest proportion in each spot.
Unlike <code>simplify.set</code>, no new labels are created. If provided, results
are stored in a list with <code>'raw'</code> and <code>'simpli.majority'</code>
elements.</p></dd>


<dt>use.generator</dt>
<dd><p>Boolean indicating whether to use generators for
prediction (<code>FALSE</code> by default).</p></dd>


<dt>batch.size</dt>
<dd><p>Number of samples per batch. Only when <code>use.generator
= TRUE</code>.</p></dd>


<dt>verbose</dt>
<dd><p>Show informative messages during the execution.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p><code><a href="SpatialDDLS-class.html">SpatialDDLS</a></code> object with a <code>deconv.spots</code></p>


<p>slot. The output is a list containing 'Regularized', 'Intrinsic' and
'Extrinsic' deconvoluted cell proportions, 'Distances' between intrinsic
and extrinsic transcriptional profiles, and 'Weight.factors' with the
final weights used to regularize intrinsic cell proportions. If
<code>simplify.set</code> and/or <code>simplify.majority</code> are provided,
the <code>deconv.spots</code> slot will contain a list with raw and simplified
results.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The deconvolution process involves two main steps: predicting cell
proportions based on transcriptome using the trained neural network model,
and regularization of cell proportions based on the spatial location of each
spot. In the regularization step, a mirrored version of each spot is
simulated based on its N-nearest spots. We refer to these profiles as
'extrinsic' profiles, whereas the transcriptional profiles of each spot are
called 'intrinsic' profiles. Extrinsic profiles are used to regularize
predictions based on intrinsic profiles. The rationale is that spots
surrounded by transcriptionally similar spots should have similar cell
compositions, and therefore predicted proportions can be smoothed to preserve
their spatial consistency. On the other hand, spots surrounded by dissimilar
spots cannot be predicted by their neighbors, and thus they can only be
predicted by their own transcriptional profiles likely due to presenting very
specific cell compositions.</p>
<p>Regarding the working os <span class="pkg">SpatialDDLS</span>: first, extrinsic profiles are
simulated based on the N-nearest spots for each spot by summing their
transcriptomes. Distances between extrinsic and intrinsic profiles of each
spot are calculated so that similar/dissimilar spots are identified. These
two sets of transcriptional profiles are used as input for the trained neural
network model, and according to the calculated distances, a weighted mean
between the predicted proportions for each spot is calculated. Spots with
distances between intrinsic and extrinsic profiles greater than
<code>alpha.cutoff</code> are not regularized, whereas spots with distances less
than <code>alpha.cutoff</code> contribute to the weighted mean. Weights are
calculated by rescaling distances less than <code>alpha.cutoff</code> between 0
and 0.5, so that the maximum extent to which a extrinsic profile can
modified the predictions based on intrinsic profiles is 0.5 (a regular
mean). For more details, see Mañanes et al., 2023.</p>
<p>This function requires a <code><a href="SpatialDDLS-class.html">SpatialDDLS</a></code> object with a
trained deep neural network model (<code><a href="trained.model.html">trained.model</a></code> slot, and the
spatial transcriptomics datasets to be deconvoluted in the
<code>spatial.experiments</code> slot. See <code>?<a href="createSpatialDDLSobject.html">createSpatialDDLSobject</a></code>
or <code>?<a href="loadSTProfiles.html">loadSTProfiles</a></code> for more details.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Mañanes, D., Rivero-García, I., Jimenez-Carretero, D.,
Torres, M., Sancho, D., Torroja, C., Sánchez-Cabo, F. (2023). SpatialDDLS:
An R package to deconvolute spatial transcriptomics data using neural
networks. biorxiv. doi: <a href="https://doi.org/10.1101/2023.08.31.555677" class="external-link">doi:10.1101/2023.08.31.555677</a>
.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="trainDeconvModel.html">trainDeconvModel</a></code> <code><a href="SpatialDDLS-class.html">SpatialDDLS</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">SingleCellExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/SingleCellExperiment.html" class="external-link">SingleCellExperiment</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  assays <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    counts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">30</span>, lambda <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">15</span>, ncol <span class="op">=</span> <span class="fl">20</span>,</span></span>
<span class="r-in"><span>      dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Gene"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"RHC"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  colData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    Cell_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"RHC"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    Cell_Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"CellType"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">20</span>,</span></span>
<span class="r-in"><span>                       replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  rowData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    Gene_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Gene"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">SDDLS</span> <span class="op">&lt;-</span> <span class="fu"><a href="createSpatialDDLSobject.html">createSpatialDDLSobject</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  sc.data <span class="op">=</span> <span class="va">sce</span>,</span></span>
<span class="r-in"><span>  sc.cell.ID.column <span class="op">=</span> <span class="st">"Cell_ID"</span>,</span></span>
<span class="r-in"><span>  sc.gene.ID.column <span class="op">=</span> <span class="st">"Gene_ID"</span>,</span></span>
<span class="r-in"><span>  sc.filt.genes.cluster <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Spatial transcriptomics data not provided</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Processing single-cell data</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>       - Filtering features:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>          - Selected features: 15</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>          - Discarded features: 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === No mitochondrial genes were found by using ^mt- as regrex</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Final number of dimensions for further analyses: 15</span>
<span class="r-in"><span><span class="va">SDDLS</span> <span class="op">&lt;-</span> <span class="fu"><a href="genMixedCellProp.html">genMixedCellProp</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  object <span class="op">=</span> <span class="va">SDDLS</span>,</span></span>
<span class="r-in"><span>  cell.ID.column <span class="op">=</span> <span class="st">"Cell_ID"</span>,</span></span>
<span class="r-in"><span>  cell.type.column <span class="op">=</span> <span class="st">"Cell_Type"</span>,</span></span>
<span class="r-in"><span>  num.sim.spots <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>  train.freq.cells <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span>,</span></span>
<span class="r-in"><span>  train.freq.spots <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span> </span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === The number of mixed profiles that will be generated is equal to 50</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Training set cells by type:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - CellType1: 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - CellType2: 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - CellType3: 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - CellType4: 2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - CellType5: 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - CellType6: 2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Test set cells by type:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - CellType1: 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - CellType2: 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - CellType3: 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - CellType4: 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - CellType5: 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - CellType6: 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Probability matrix for training data:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Mixed spots: 34</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Cell types: 6</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Probability matrix for test data:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Mixed spots: 16</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Cell types: 6</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> DONE</span>
<span class="r-in"><span><span class="va">SDDLS</span> <span class="op">&lt;-</span> <span class="fu"><a href="simMixedProfiles.html">simMixedProfiles</a></span><span class="op">(</span><span class="va">SDDLS</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Setting parallel environment to 1 thread(s)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Generating train mixed profiles:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Generating test mixed profiles:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> DONE</span>
<span class="r-in"><span><span class="co"># training of SDDLS model</span></span></span>
<span class="r-in"><span><span class="va">SDDLS</span> <span class="op">&lt;-</span> <span class="fu"><a href="trainDeconvModel.html">trainDeconvModel</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  object <span class="op">=</span> <span class="va">SDDLS</span>,</span></span>
<span class="r-in"><span>  batch.size <span class="op">=</span> <span class="fl">15</span>,</span></span>
<span class="r-in"><span>  num.epochs <span class="op">=</span> <span class="fl">5</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Training and test from stored data</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Using only simulated mixed samples</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Using only simulated mixed samples</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model: "SpatialDDLS"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _____________________________________________________________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Layer (type)                   Output Shape               Param #    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =====================================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dense1 (Dense)                 (None, 200)                3200       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _____________________________________________________________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BatchNormalization1 (BatchNorm (None, 200)                800        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _____________________________________________________________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Activation1 (Activation)       (None, 200)                0          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _____________________________________________________________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dropout1 (Dropout)             (None, 200)                0          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _____________________________________________________________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dense2 (Dense)                 (None, 200)                40200      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _____________________________________________________________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BatchNormalization2 (BatchNorm (None, 200)                800        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _____________________________________________________________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Activation2 (Activation)       (None, 200)                0          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _____________________________________________________________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dropout2 (Dropout)             (None, 200)                0          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _____________________________________________________________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dense3 (Dense)                 (None, 6)                  1206       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _____________________________________________________________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BatchNormalization3 (BatchNorm (None, 6)                  24         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _____________________________________________________________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ActivationSoftmax (Activation) (None, 6)                  0          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =====================================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total params: 46,230</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Trainable params: 45,418</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Non-trainable params: 812</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _____________________________________________________________________</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Training DNN with 34 samples:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Evaluating DNN in test data (16 samples)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    - loss: 1.6916</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    - accuracy: 0.125</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    - mean_absolute_error: 0.2476</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    - categorical_accuracy: 0.125</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Generating prediction results using test data</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> DONE</span>
<span class="r-in"><span><span class="co"># simulating spatial data</span></span></span>
<span class="r-in"><span><span class="va">ngenes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">40</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ncells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">40</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">ngenes</span> <span class="op">*</span> <span class="va">ncells</span>, lambda <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">ncells</span>,</span></span>
<span class="r-in"><span>  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Gene"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">ngenes</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Spot"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">ncells</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">coordinates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">ncells</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">st</span> <span class="op">&lt;-</span> <span class="fu">SpatialExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment.html" class="external-link">SpatialExperiment</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  assays <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  rowData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Gene_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Gene"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">ngenes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  colData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Cell_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Spot"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">ncells</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  spatialCoords <span class="op">=</span> <span class="va">coordinates</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">SDDLS</span> <span class="op">&lt;-</span> <span class="fu"><a href="loadSTProfiles.html">loadSTProfiles</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  object <span class="op">=</span> <span class="va">SDDLS</span>,</span></span>
<span class="r-in"><span>  st.data <span class="op">=</span> <span class="va">st</span>,</span></span>
<span class="r-in"><span>  st.spot.ID.column <span class="op">=</span> <span class="st">"Cell_ID"</span>,</span></span>
<span class="r-in"><span>  st.gene.ID.column <span class="op">=</span> <span class="st">"Gene_ID"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === 1 SpatialExperiment objects provided</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    === Processing spatial transcriptomics data</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>       - Filtering features:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>          - Selected features: 27</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>          - Discarded features: 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># simplify arguments</span></span></span>
<span class="r-in"><span><span class="va">simplify</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>CellGroup1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CellType1"</span>, <span class="st">"CellType2"</span>, <span class="st">"CellType4"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 CellGroup2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CellType3"</span>, <span class="st">"CellType5"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">SDDLS</span> <span class="op">&lt;-</span> <span class="fu">deconvSpatialDDLS</span><span class="op">(</span></span></span>
<span class="r-in"><span>  object <span class="op">=</span> <span class="va">SDDLS</span>,</span></span>
<span class="r-in"><span>  index.st <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  simplify.set <span class="op">=</span> <span class="va">simplify</span>, </span></span>
<span class="r-in"><span>  simplify.majority <span class="op">=</span> <span class="va">simplify</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Filtering out 12 features in data that are not present in trained model</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Normalizing data (LogCPM)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Predicting cell type proportions</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Calculating distances in PCA space</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Calculating 50 PCs</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>You're computing too large a percentage of total singular values, use a standard svd instead.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Calculating alpha factors based on distances</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> === Note that only regularized proportions will be simplified</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> DONE</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://github.com/diegommcc" class="external-link">Diego Mañanes</a>, <a href="https://www.cnic.es/en/carlos-torroja" class="external-link">Carlos Torroja</a>, <a href="https://www.cnic.es/en/fatima-sanchez-cabo" class="external-link">Fatima Sanchez-Cabo</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

